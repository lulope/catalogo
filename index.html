<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
  <title>CatÃ¡logo Profissional Â· Lulope</title>
  <!-- Fontes e Ã­cones -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,400;14..32,500;14..32,600;14..32,700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- Font Awesome 6 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary: #d63384;
      --primary-light: #f8e1ec;
      --primary-dark: #b0206a;
      --secondary: #6c5ce7;
      --bg: #f9f4f7;
      --surface: #ffffff;
      --text: #2d2d2d;
      --text-light: #6b6b6b;
      --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.05);
      --shadow-md: 0 8px 24px rgba(214, 51, 132, 0.12);
      --radius: 20px;
      --radius-sm: 12px;
      --transition: all 0.25s ease;
    }

    body {
      font-family: 'Inter', 'Poppins', Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.5;
      padding-top: 130px;
      min-height: 100vh;
    }

    /* ===== Header ===== */
    header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      z-index: 1000;
      padding: 12px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 10px;
      border-bottom: 1px solid rgba(214, 51, 132, 0.2);
    }

    .logo-area {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    #logo {
      height: 48px;
      width: auto;
      object-fit: contain;
    }

    header h1 {
      font-size: 1.6rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -0.5px;
    }

    /* ===== Filtros (apenas categoria) ===== */
    .filters {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      gap: 12px;
      max-width: 1200px;
      margin: 0 auto 30px;
      padding: 0 20px;
    }

    .filter-group {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      flex: 1 1 auto;
      justify-content: center;
    }

    .filters select,
    .filters input,
    .filters button {
      appearance: none;
      -webkit-appearance: none;
      padding: 12px 20px;
      border: 2px solid transparent;
      border-radius: 60px;
      background: var(--surface);
      box-shadow: var(--shadow-sm);
      font-size: 0.95rem;
      font-weight: 500;
      color: var(--text);
      outline: none;
      transition: var(--transition);
      cursor: pointer;
      font-family: inherit;
      min-width: 200px;
      flex: 0 1 auto;
    }

    .filters select {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='%23d63384'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 16px center;
      background-size: 18px;
      padding-right: 48px;
    }

    .filters input[type="text"] {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='%23d63384'%3E%3Cpath d='M10 2a8 8 0 015.29 13.71l4 4a1 1 0 01-1.42 1.42l-4-4A8 8 0 1110 2zm0 2a6 6 0 100 12A6 6 0 0010 4z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: left 16px center;
      background-size: 18px;
      padding-left: 48px;
    }

    .filters select:hover,
    .filters input:hover,
    .filters button:hover {
      border-color: var(--primary-light);
      box-shadow: var(--shadow-md);
      transform: translateY(-2px);
    }

    .filters select:focus,
    .filters input:focus,
    .filters button:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 4px rgba(214, 51, 132, 0.25);
    }

    #togglePreco {
      background: var(--primary);
      color: white;
      border: none;
      font-size: 1.2rem;
      padding: 12px 24px;
      min-width: auto;
      box-shadow: 0 8px 16px rgba(214, 51, 132, 0.3);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    #togglePreco i {
      font-size: 1.2rem;
    }

    #togglePreco:hover {
      background: var(--primary-dark);
      transform: scale(1.02);
    }

    /* ===== CatÃ¡logo ===== */
    #catalogo {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 30px;
      padding: 20px 25px;
      max-width: 1400px;
      margin: 0 auto;
    }

    .spu {
      background: var(--surface);
      border-radius: var(--radius);
      box-shadow: var(--shadow-sm);
      overflow: hidden;
      transition: var(--transition);
      display: flex;
      flex-direction: column;
      backdrop-filter: blur(4px);
      border: 1px solid rgba(214, 51, 132, 0.1);
    }

    .spu:hover {
      transform: translateY(-8px);
      box-shadow: var(--shadow-md);
      border-color: var(--primary-light);
    }

    .spu h2 {
      font-size: 1.25rem;
      font-weight: 600;
      margin: 16px 16px 4px;
      color: var(--primary-dark);
      letter-spacing: -0.3px;
      line-height: 1.3;
    }

    /* ReferÃªncia do produto (apenas SKU) */
    .referencia {
      font-size: 0.9rem;
      color: var(--text-light);
      margin: 0 16px 8px;
      padding-bottom: 8px;
      border-bottom: 1px dashed rgba(214, 51, 132, 0.2);
      font-weight: 500;
    }

    .referencia span {
      color: var(--primary);
      font-weight: 600;
    }

    /* Carrossel */
    .carousel-container {
      position: relative;
      width: 100%;
      aspect-ratio: 1 / 1;
      background: #fafafa;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius) var(--radius) 0 0;
      overflow: hidden;
      padding: 10px;
    }

    .carousel-image {
      width: 100%;
      height: 100%;
      object-fit: contain;
      transition: opacity 0.2s;
      background: white;
      cursor: pointer;
      border-radius: 8px;
    }

    .loader {
      position: absolute;
      width: 40px;
      height: 40px;
      border: 3px solid var(--primary-light);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    .carousel-btn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(4px);
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      font-size: 24px;
      font-weight: bold;
      color: var(--primary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: var(--transition);
      opacity: 0.9;
      z-index: 5;
    }

    .carousel-btn:hover {
      background: white;
      color: var(--primary-dark);
      transform: translateY(-50%) scale(1.1);
      opacity: 1;
    }

    .carousel-btn.prev { left: 12px; }
    .carousel-btn.next { right: 12px; }

    /* Miniaturas */
    .thumbs-container {
      display: flex;
      justify-content: center;
      gap: 8px;
      padding: 12px 8px;
      flex-wrap: wrap;
      background: #fff;
    }

    .thumb {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      object-fit: contain;
      border: 2px solid transparent;
      cursor: pointer;
      transition: var(--transition);
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      background: #fff;
      padding: 2px;
    }

    .thumb:hover {
      transform: scale(1.1);
      border-color: var(--primary-light);
    }

    .thumb.active {
      border-color: var(--primary);
      transform: scale(1.1);
      box-shadow: 0 4px 10px rgba(214, 51, 132, 0.3);
    }

    /* Etiquetas de informaÃ§Ã£o */
    .info-tags {
      padding: 8px 16px 20px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .linha-inferior {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .info-tag {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 14px;
      border-radius: 40px;
      font-size: 0.85rem;
      font-weight: 600;
      background: #f4f4f4;
      color: var(--text);
      box-shadow: 0 2px 5px rgba(0,0,0,0.02);
    }

    .info-tag.cor {
      background: #fce4ec;
      color: #c2185b;
    }
    .info-tag.grade {
      background: #ede7f6;
      color: #512da8;
    }
    .info-tag.preco {
      background: #e8f5e9;
      color: #2e7d32;
    }
    .info-tag i {
      font-size: 1.1rem;
      width: 1.2rem;
      text-align: center;
    }

    /* Mensagem de nenhum produto */
    .no-products {
      grid-column: 1 / -1;
      text-align: center;
      padding: 60px 20px;
      font-size: 1.2rem;
      color: var(--text-light);
      background: var(--surface);
      border-radius: var(--radius);
      box-shadow: var(--shadow-sm);
    }

    /* ===== Modal de zoom ===== */
    #imageModal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(8px);
      z-index: 2000;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    #modalContent {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
      height: calc(100% - 100px);
      overflow: auto;
      padding: 20px;
    }

    #modalImg {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      transition: width 0.2s, height 0.2s;
      border-radius: 8px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.5);
    }

    #closeModal {
      position: fixed;
      top: 20px; right: 20px;
      background: var(--primary);
      color: white;
      border: none;
      padding: 14px 20px;
      border-radius: 60px;
      font-weight: bold;
      font-size: 1rem;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(214, 51, 132, 0.4);
      transition: var(--transition);
      z-index: 2100;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    #closeModal:hover {
      background: var(--primary-dark);
      transform: scale(1.05);
    }

    #zoomContainer {
      position: fixed;
      bottom: 30px; right: 30px;
      display: flex;
      gap: 15px;
      z-index: 2100;
    }

    #zoomContainer button {
      background: white;
      color: var(--primary);
      border: none;
      width: 60px;
      height: 60px;
      border-radius: 60px;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #zoomContainer button:hover {
      background: var(--primary);
      color: white;
      transform: scale(1.1);
    }

    /* ===== Responsividade ===== */
    @media (max-width: 700px) {
      body { padding-top: 160px; }
      header { flex-direction: column; text-align: center; }
      .logo-area { justify-content: center; }
      .filters select, .filters input, .filters button { width: 100%; min-width: auto; }
      #catalogo { grid-template-columns: 1fr; padding: 15px; }
      .spu { max-width: 400px; margin: 0 auto; width: 100%; }
      #zoomContainer { bottom: 20px; right: 20px; gap: 10px; }
      #zoomContainer button { width: 50px; height: 50px; font-size: 24px; }
    }
  </style>
</head>
<body>
  <header>
    <div class="logo-area">
      <img id="logo" src="logo.png" alt="Lulope Logo" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'48\' height=\'48\' viewBox=\'0 0 24 24\' fill=\'%23d63384\'%3E%3Cpath d=\'M4 4h16v16H4z\' fill=\'%23fce4ec\'/%3E%3Ctext x=\'4\' y=\'18\' font-family=\'Arial\' font-size=\'4\' fill=\'%23d63384\'%3ELogo%3C/text%3E%3C/svg%3E'">
      <h1>CatÃ¡logo</h1>
    </div>
    <div class="filters">
      <div class="filter-group">
        <select id="categorias"></select>
      </div>
      <div class="filter-group">
        <input type="text" id="spuBusca" placeholder="Buscar produto...">
        <button id="togglePreco"><i class="fas fa-lock"></i> <span>PreÃ§os</span></button>
      </div>
    </div>
  </header>

  <div id="catalogo"></div>

  <!-- Modal de zoom -->
  <div id="imageModal">
    <div id="modalContent">
      <img id="modalImg">
    </div>
    <button id="closeModal"><i class="fas fa-times"></i> Fechar</button>
    <div id="zoomContainer">
      <button onclick="zoomIn()"><i class="fas fa-search-plus"></i></button>
      <button onclick="zoomOut()"><i class="fas fa-search-minus"></i></button>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-app.js";
    import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-database.js";
    import { getStorage, ref as storageRef, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBlLB2K6Sj9kQ9pVAu7rt-Db0jsC-hyvmU",
      authDomain: "applulope.firebaseapp.com",
      databaseURL: "https://applulope-default-rtdb.firebaseio.com",
      projectId: "applulope",
      storageBucket: "applulope.appspot.com",
      messagingSenderId: "327504288727",
      appId: "1:327504288727:web:96e7bfc239cf9337c9c992"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const storage = getStorage(app);

    const produtosRef = ref(db, "Produtos/SPU");
    const categoriasRef = ref(db, "Produtos/Categorias");
    const senhaRef = ref(db, "SenhaCatalogo");

    let precosVisiveis = false;

    const placeholderImg = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200' viewBox='0 0 24 24' fill='%23d63384'%3E%3Cpath d='M4 4h16v16H4z' fill='%23fce4ec'/%3E%3Ctext x='4' y='18' font-family='Arial' font-size='4' fill='%23d63384'%3E sem imagem %3C/text%3E%3C/svg%3E";

    async function carregarCategorias() {
      const snap = await get(categoriasRef);
      const cats = snap.val();
      const selectCat = document.getElementById("categorias");
      selectCat.innerHTML = "<option value=''>Todas as categorias</option>";
      if (cats) {
        for (let c in cats) {
          const o = document.createElement("option");
          o.value = c;
          o.textContent = c;
          selectCat.appendChild(o);
        }
      }
    }

    document.getElementById("categorias").addEventListener("change", carregarProdutos);

    let timeoutBusca;
    document.getElementById("spuBusca").addEventListener("input", () => {
      clearTimeout(timeoutBusca);
      timeoutBusca = setTimeout(carregarProdutos, 400);
    });

    async function carregarProdutos() {
      const cat = document.getElementById("categorias").value;
      const busca = document.getElementById("spuBusca").value.toLowerCase().trim();

      const snap = await get(produtosRef);
      const produtos = snap.val();
      const catalogo = document.getElementById("catalogo");
      catalogo.innerHTML = "";

      if (!produtos) {
        catalogo.innerHTML = '<div class="no-products"><i class="fas fa-box-open"></i> Nenhum produto encontrado.</div>';
        return;
      }

      let produtosFiltrados = 0;

      for (let spu in produtos) {
        const p = produtos[spu];
        if (!p.SKU) continue;

        if (cat && p.Categoria !== cat) continue;
        if (busca && !spu.toLowerCase().includes(busca)) continue;

        produtosFiltrados++;

        const skuKeys = Object.keys(p.SKU);
        let idx = 0;

        const div = document.createElement("div");
        div.classList.add("spu");

        const titulo = document.createElement("h2");
        titulo.textContent = `${spu} ${p.Categoria ? 'Â· ' + p.Categoria : ''}`;
        div.appendChild(titulo);

        // ReferÃªncia: apenas o SKU
        const refDiv = document.createElement("div");
        refDiv.classList.add("referencia");
        refDiv.innerHTML = `SKU: <span class="ref-texto"></span>`;
        div.appendChild(refDiv);

        const carousel = document.createElement("div");
        carousel.classList.add("carousel-container");
        const loader = document.createElement("div");
        loader.classList.add("loader");
        const img = document.createElement("img");
        img.classList.add("carousel-image");
        img.style.opacity = "0";
        carousel.append(loader, img);

        const prevBtn = document.createElement("button");
        prevBtn.classList.add("carousel-btn", "prev");
        prevBtn.innerHTML = "â€¹";
        const nextBtn = document.createElement("button");
        nextBtn.classList.add("carousel-btn", "next");
        nextBtn.innerHTML = "â€º";
        carousel.append(prevBtn, nextBtn);
        div.appendChild(carousel);

        const thumbs = document.createElement("div");
        thumbs.classList.add("thumbs-container");
        div.appendChild(thumbs);

        const tags = document.createElement("div");
        tags.classList.add("info-tags");
        const corTag = document.createElement("div");
        corTag.classList.add("info-tag", "cor");
        corTag.innerHTML = '<i class="fas fa-palette"></i> <span class="cor-texto"></span>';
        const linhaInferior = document.createElement("div");
        linhaInferior.classList.add("linha-inferior");
        const gradeTag = document.createElement("div");
        gradeTag.classList.add("info-tag", "grade");
        gradeTag.innerHTML = '<i class="fas fa-ruler-combined"></i> <span class="grade-texto"></span>';
        const precoTag = document.createElement("div");
        precoTag.classList.add("info-tag", "preco");
        precoTag.innerHTML = '<i class="fas fa-tag"></i> <span class="preco-texto"></span>';
        precoTag.style.display = precosVisiveis ? "flex" : "none";
        linhaInferior.append(gradeTag, precoTag);
        tags.append(corTag, linhaInferior);
        div.appendChild(tags);

        skuKeys.forEach((sku, i) => {
          const thumb = document.createElement("img");
          thumb.classList.add("thumb");
          getDownloadURL(storageRef(storage, `CATÃLOGO/${sku}.jpg`))
            .then(url => thumb.src = url)
            .catch(() => thumb.src = placeholderImg);
          thumb.addEventListener("click", () => {
            idx = i;
            atualizarCard(idx);
          });
          thumbs.appendChild(thumb);
        });

        const atualizarCard = async (i) => {
          const sku = skuKeys[i];
          const dados = p.SKU[sku];

          corTag.querySelector(".cor-texto").textContent = dados.Cor || "â€”";
          gradeTag.querySelector(".grade-texto").textContent = `${dados.Inicio || "?"} ao ${dados.Fim || "?"}`;
          precoTag.querySelector(".preco-texto").textContent = dados.Valor ? `R$ ${dados.Valor}` : "Sob consulta";
          
          // ReferÃªncia: apenas o SKU
          refDiv.querySelector(".ref-texto").textContent = sku;

          thumbs.querySelectorAll(".thumb").forEach((t, j) => {
            t.classList.toggle("active", j === i);
          });

          loader.style.display = "block";
          img.style.opacity = "0";
          try {
            const url = await getDownloadURL(storageRef(storage, `CATÃLOGO/${sku}.jpg`));
            img.src = url;
          } catch {
            img.src = placeholderImg;
          } finally {
            img.onload = () => {
              loader.style.display = "none";
              img.style.opacity = "1";
            };
          }
        };

        prevBtn.addEventListener("click", () => {
          idx = (idx - 1 + skuKeys.length) % skuKeys.length;
          atualizarCard(idx);
        });
        nextBtn.addEventListener("click", () => {
          idx = (idx + 1) % skuKeys.length;
          atualizarCard(idx);
        });

        img.addEventListener("click", () => {
          abrirModal(img.src);
        });

        catalogo.appendChild(div);
        atualizarCard(0);
      }

      if (produtosFiltrados === 0) {
        catalogo.innerHTML = '<div class="no-products"><i class="fas fa-search"></i> Nenhum produto corresponde aos filtros.</div>';
      }
    }

    // Modal zoom functions
    let naturalWidth = 0, naturalHeight = 0, initialScale = 1, currentScale = 1;

    window.abrirModal = function(src) {
      const modal = document.getElementById("imageModal");
      const modalImg = document.getElementById("modalImg");
      modal.style.display = "flex";
      modalImg.src = src;

      modalImg.onload = function() {
        naturalWidth = this.naturalWidth;
        naturalHeight = this.naturalHeight;
        const scale = Math.min(
          (window.innerWidth * 0.9) / naturalWidth,
          (window.innerHeight * 0.8) / naturalHeight,
          1
        );
        initialScale = scale;
        currentScale = scale;
        this.style.width = naturalWidth * scale + "px";
        this.style.height = naturalHeight * scale + "px";
      };
    };

    window.fecharModal = function() {
      document.getElementById("imageModal").style.display = "none";
    };

    window.zoomIn = function() {
      currentScale = Math.min(currentScale * 1.2, initialScale * 6);
      const img = document.getElementById("modalImg");
      img.style.width = naturalWidth * currentScale + "px";
      img.style.height = naturalHeight * currentScale + "px";
    };

    window.zoomOut = function() {
      currentScale = Math.max(currentScale * 0.8, initialScale);
      const img = document.getElementById("modalImg");
      img.style.width = naturalWidth * currentScale + "px";
      img.style.height = naturalHeight * currentScale + "px";
    };

    document.getElementById("closeModal").addEventListener("click", fecharModal);
    document.getElementById("imageModal").addEventListener("click", (e) => {
      if (e.target === document.getElementById("imageModal")) fecharModal();
    });

    // Controle de preÃ§os
    async function togglePrecos() {
      const botao = document.getElementById("togglePreco");
      const icone = botao.querySelector('i');
      if (precosVisiveis) {
        document.querySelectorAll(".preco").forEach(el => el.style.display = "none");
        icone.className = "fas fa-lock";
        precosVisiveis = false;
      } else {
        const senha = prompt("ðŸ” Digite a senha para visualizar os preÃ§os:");
        if (senha) {
          try {
            const snap = await get(senhaRef);
            if (snap.val() === senha) {
              document.querySelectorAll(".preco").forEach(el => el.style.display = "flex");
              icone.className = "fas fa-lock-open";
              precosVisiveis = true;
            } else {
              alert("âŒ Senha incorreta!");
            }
          } catch {
            alert("Erro ao verificar senha.");
          }
        }
      }
    }

    document.getElementById("togglePreco").addEventListener("click", togglePrecos);

    document.addEventListener("DOMContentLoaded", () => {
      carregarCategorias();
      carregarProdutos();
    });
  </script>
</body>
</html>
